<!DOCTYPE html>
<html lang="ko">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>참고해라 - 공군 지원 정보 서비스</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />

  <!-- fullPage.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/4.0.13/fullpage.min.css" />

  <style>
    @font-face {
      font-family: 'Paperlogy-8ExtraBold';
      src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/2408-3@1.0/Paperlogy-8ExtraBold.woff2') format('woff2');
      font-weight: 800;
      font-style: normal;
    }

    /* 기본 스타일 */
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Paperlogy-8ExtraBold', sans-serif;
      height: 100%;
      width: 100%;
    }

    /* 섹션 스타일 */
    .section {
      height: 100vh;
      width: 100%;
      position: relative;
    }

    /* 섹션 1 배경 이미지 */
    #section1 {
      background-image: url('{% static "images/airforcebg.svg" %}');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* 섹션 2 배경 색상 */
    #section2 {
      background-color: #f8f9fa;
    }

    /* FullCalendar 스타일 */
    .fc-toolbar-title {
      font-size: 1.75rem;
      font-weight: 600;
      color: #2C3E50;
    }

    .fc-button {
      background-color: #6c757d !important;
      border: none !important;
      padding: 10px 20px !important;
      color: white !important;
      font-weight: 600 !important;
      border-radius: 5px !important;
    }

    .fc-button:hover {
      background-color: #5a6268 !important;
    }

    .fc-event {
      background-color: skyblue !important;
      border: none !important;
      color: white !important;
      font-weight: 600 !important;
      padding: 2px 5px !important;
      border-radius: 4px !important;
    }

    .fc-today {
      background-color: rgba(108, 117, 125, 0.2) !important;
    }

    #calendar {
      width: 90%;
      height: 700px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* 폼 스타일 */
    #score-form {
      max-width: 1200px;
      width: 90%;
      margin: 0 auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #score-form label {
      font-weight: 600;
      font-size: 1.1rem;
    }

    #score-form button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      font-size: 1.2rem;
    }

    .additional-score-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
    }

    /* 반응형 디자인 */
    @media (max-width: 1400px) {
      #score-form {
        width: 95%;
      }
      .additional-score-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (max-width: 768px) {
      .additional-score-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .additional-score-grid {
        grid-template-columns: 1fr;
      }
    }

    /* 모달 스타일 */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    .modal-content button.close-modal {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #555;
    }

    /* 네비게이션 툴팁 스타일 */
    .fp-tooltip {
      background-color: #333;
      color: white;
      padding: 10px 20px;
      border-radius: 4px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <div id="fullpage">
    <!-- 섹션 1 -->
    <div class="section" data-anchor="section1" id="section1">
      <!-- 콘텐츠 박스 -->
      <div class="content-wrapper text-center z-10 px-8 py-16 bg-white bg-opacity-80 shadow-xl rounded-lg">
        <h1 class="text-6xl font-extrabold text-blue-600">공군 지원 정보 서비스</h1><br>
        <h1 class="text-6xl font-extrabold text-blue-600">"참고해라"</h1>
        <p class="mt-6 text-xl text-gray-800">가기 싫은 군대, 공군이라도 가자..</p>
        <p class="mt-6 text-xl text-gray-800">아래로 스크롤해 지원 정보와 합격 가능성을 알아보자.</p>
        <div class="mt-8">
          <a href="#section2" class="inline-block px-6 py-3 text-white bg-blue-500 hover:bg-blue-600 rounded-lg shadow-lg transition duration-300 ease-in-out">
            관련 일정 보러가기
          </a>
        </div>
      </div>
    </div>

    <!-- 섹션 2 -->
    <div class="section" data-anchor="section2" id="section2">
      <div class="container mx-auto py-8">
        <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">공군 지원일 & 자격증 시험일 캘린더</h1>
        <div id="calendar" class="bg-white p-4 rounded-lg shadow-lg"></div>
      </div>
    </div>

    <!-- 섹션 3 (지원 자격 요약) -->
    <div class="section" data-anchor="section3" id="section3">
      <div class="container mx-auto py-8">
        <h1 class="text-4xl font-bold text-center text-blue-600 mb-10">지원 자격 요약</h1>
        
        <!-- 연령, 신체 요건 카드 -->
        <div class="bg-white p-6 rounded-lg shadow-lg mb-6">
          <h2 class="text-2xl font-bold mb-4">연령 및 신체 요건</h2>
          <p class="text-lg"><strong>연령:</strong> 지원서 접수년도 기준 18세 이상, 28세 이하 (1996.1.1 ~ 2006.12.31 출생자)</p>
          <p class="text-lg"><strong>신체 요건:</strong> 병역판정검사 결과 신체등급 1급 ~ 4급 현역병 입영 대상자</p>
          <p class="text-lg">신체검사를 받지 않은 사람은 접수 후 현역병 지원 신체검사 별도 실시</p>
        </div>

        <!-- 색약/색맹 지원 가능 분야 카드 -->
        <div class="bg-white p-6 rounded-lg shadow-lg mb-6">
          <h2 class="text-2xl font-bold mb-4">색약/색맹 지원 가능 분야</h2>
          <p class="text-lg"><strong>일반 기술병:</strong> 일반, 기계, 의무</p>
          <p class="text-lg"><strong>전문특기병:</strong> 군악병, 의장병, 우주기상분석병, 조리병, 어학병, IT개발관리병</p>
          <p class="text-lg"><strong>색약 가능 분야:</strong> 차량운전, 전자계산, 통신전자전기, 차량정비 등</p>
        </div>

        <!-- 선발 제외 대상 카드 -->
        <div class="bg-white p-6 rounded-lg shadow-lg mb-6">
          <h2 class="text-2xl font-bold mb-4">선발 제외 대상</h2>
          <p class="text-lg">징역 또는 금고형을 선고받은 사람, 수사 중인 사람, 허위 서류 제출자 등은 선발에서 제외됩니다.</p>
        </div>

        <!-- 유의사항 카드 -->
        <div class="bg-white p-6 rounded-lg shadow-lg">
          <h2 class="text-2xl font-bold mb-4">유의사항</h2>
          <p class="text-lg">1차 합격 후 다음 회차 지원 불가 (예외: 1차 합격 후 지원서 취소 시 다음 회차 지원 가능)</p>
          <p class="text-lg">대체역 편입원을 제출한 경우 모집병 선발 제외</p>
        </div>
      </div>
    </div>

    <!-- 섹션 4 -->
    <div class="section" data-anchor="section4" id="section4">
      <div class="container mx-auto py-8">
        <h1 class="text-4xl font-bold text-center text-blue-600 mb-6">공군 일반 기술병 점수 계산기</h1>
        <p class="text-center text-gray-600 mb-11">아래에서 골라 합격을 예측해보세요!</p>

        <form method="POST" class="space-y-4" id="score-form">
          {% csrf_token %}

          <!-- 자격/면허 점수 -->
          <div>
            <label for="license_score" class="block text-lg font-semibold text-gray-700 mb-2">자격/면허 점수</label>
            <select name="license_score" id="license_score" required>
              <option value="0">자격증 없음 (0점)</option>
              <option value="60">일반자격증 - L2 (60점)</option>
              <option value="62">일반자격증 - L4, L3 (62점)</option>
              <option value="64">일반자격증 - L6, L5 (64점)</option>
              <option value="66">국가기술자격증 - 기능사 (66점)</option>
              <option value="68">국가기술자격증 - 산업기사 (68점)</option>
              <option value="70">국가기술자격증 - 기사 이상 (70점)</option>
            </select>
          </div>

          <!-- 출결 점수 -->
          <div>
            <label for="attendance_score" class="block text-lg font-semibold text-gray-700 mb-2">출결 점수</label>
            <select name="attendance_score" id="attendance_score" required>
              <option value="16">결석 7일 이상 (16점)</option>
              <option value="17">결석 5~6일 (17점)</option>
              <option value="18">결석 3~4일 (18점)</option>
              <option value="19">결석 1~2일 (19점)</option>
              <option value="20">결석 0일 (20점)</option>
            </select>
          </div>

          <!-- 면접 점수 -->
          <div>
            <label for="interview_score" class="block text-lg font-semibold text-gray-700 mb-2">면접 점수</label>
            <select name="interview_score" id="interview_score" required>
              <option value="25">면접 평가 부족 (25점)</option>
              <option value="30">면접 평가 보통 (30점)</option>
              <option value="35">면접 평가 우수 (35점)</option>
            </select>
          </div>

          <!-- 가산점 -->
          <div>
            <label class="block text-lg font-semibold text-gray-700 mb-2">가산점(최대 15점)</label>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-2 gap-4">
              <!-- 병역진로설계 군 추천특기 -->
              <div class="flex items-center space-x-2">
                <input type="checkbox" name="additional_score[]" value="1" id="option9" class="form-checkbox h-4 w-4 text-blue-600">
                <label for="option9" class="text-sm text-gray-700">병역진로설계 군 추천특기 (1점)</label>
              </div>
              <!-- 국가유공자 자녀/손자녀 -->
              <div class="flex items-center space-x-2">
                <input type="checkbox" name="additional_score[]" value="4" id="option1" class="form-checkbox h-4 w-4 text-blue-600">
                <label for="option1" class="text-sm text-gray-700">국가 유공자 자녀/손자녀 (4점)</label>
              </div>
              <!-- 다자녀(2인) 가정자녀 -->
              <div class="flex items-center space-x-2">
                <input type="checkbox" name="additional_score[]" value="2" id="option6" class="form-checkbox h-4 w-4 text-blue-600">
                <label for="option6" class="text-sm text-gray-700">다자녀(2인) 가정자녀 (2점)</label>
              </div>
              <!-- 다자녀(3인 이상) 가정자녀 -->
              <div class="flex items-center space-x-2">
                <input type="checkbox" name="additional_score[]" value="4" id="option5" class="form-checkbox h-4 w-4 text-blue-600">
                <label for="option5" class="text-sm text-gray-700">다자녀(3인 이상) 가정자녀 (4점)</label>
              </div>
              <!-- 질병치유 자진입대 -->
              <div class="flex items-center space-x-2">
                <input type="checkbox" name="additional_score[]" value="4" id="option2" class="form-checkbox h-4 w-4 text-blue-600">
                <label for="option2" class="text-sm text-gray-700">질병치유 자진입대 (4점)</label>
              </div>
              <!-- 현역병 입영대상으로 역종 변경 -->
              <div class="flex items-center space-x-2">
                <input type="checkbox" name="additional_score[]" value="4" id="option3" class="form-checkbox h-4 w-4 text-blue-600">
                <label for="option3" class="text-sm text-gray-700">현역병 입영대상으로 역종 변경 (4점)</label>
              </div>
              <!-- 국외이주자 중 현역복무지원자 -->
              <div class="flex items-center space-x-2">
                <input type="checkbox" name="additional_score[]" value="4" id="option4" class="form-checkbox h-4 w-4 text-blue-600">
                <label for="option4" class="text-sm text-gray-700">국외이주자 중 현역복무지원자 (4점)</label>
              </div>
              <!-- 경제적 약자 지원대상 -->
              <div class="flex items-center space-x-2">
                <input type="checkbox" name="additional_score[]" value="4" id="option7" class="form-checkbox h-4 w-4 text-blue-600">
                <label for="option7" class="text-sm text-gray-700">경제적 약자 지원대상 (4점)</label>
              </div>
            </div>

            <!-- 드롭다운 옵션들 -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
              <!-- 사회봉사활동 드롭다운 -->
              <div>
                <label for="volunteerScore" class="block text-sm font-semibold text-gray-700 mb-2">사회봉사활동 점수</label>
                <select name="additional_score[]" id="volunteerScore" class="w-full border-gray-300 rounded-md shadow-sm">
                  <option value="">없음</option>
                  <option value="1">8시간 이상 - 1점</option>
                  <option value="2">16시간 이상 - 2점</option>
                  <option value="3">24시간 이상 - 3점</option>
                  <option value="4">32시간 이상 - 4점</option>
                  <option value="5">40시간 이상 - 5점</option>
                  <option value="6">48시간 이상 - 6점</option>
                  <option value="7">56시간 이상 - 7점</option>
                  <option value="8">64시간 이상 - 8점</option>
                </select>
              </div>
              <!-- 헌혈 드롭다운 -->
              <div>
                <label for="bloodDonationScore" class="block text-sm font-semibold text-gray-700 mb-2">헌혈 점수</label>
                <select name="additional_score[]" id="bloodDonationScore" class="w-full border-gray-300 rounded-md shadow-sm">
                  <option value="">없음</option>
                  <option value="1">1회 - 1점</option>
                  <option value="2">2회 - 2점</option>
                  <option value="3">3회 - 3점</option>
                  <option value="4">4회 - 4점</option>
                  <option value="5">5회 - 5점</option>
                  <option value="6">6회 - 6점</option>
                  <option value="7">7회 - 7점</option>
                  <option value="8">8회 - 8점</option>
                </select>
              </div>
              <!-- TOEIC 선택 -->
              <div>
                <label for="toeicScore" class="block text-sm font-semibold text-gray-700 mb-2">TOEIC 점수</label>
                <select name="additional_score[]" id="toeicScore" class="w-full border-gray-300 rounded-md shadow-sm">
                  <option value="0">없음</option>
                  <option value="1">520 ~ 729점 - 1점</option>
                  <option value="2">730점 이상 - 2점</option>
                </select>
              </div>
              <!-- 한국사능력검정 선택 -->
              <div>
                <label for="koreanHistoryScore" class="block text-sm font-semibold text-gray-700 mb-2">한국사능력검정 점수</label>
                <select name="additional_score[]" id="koreanHistoryScore" class="w-full border-gray-300 rounded-md shadow-sm">
                  <option value="0">없음</option>
                  <option value="1">3, 4급 - 1점</option>
                  <option value="2">1, 2급 - 2점</option>
                </select>
              </div>
            </div>
          </div>

          <!-- 제출 및 초기화 버튼 -->
          <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white rounded-lg">계산하기</button>
          <button type="button" class="bg-gray-500 hover:bg-gray-600 text-white rounded-lg mt-4" onclick="resetForm();">초기화</button>

          <!-- 결과 표시 -->
          <div id="result" class="mt-8 bg-green-100 p-4 rounded-lg text-center text-lg"></div>
        </form>
      </div>
    </div>

    <!-- 섹션 5 (빈 화면) -->
    <div class="section" data-anchor="section5" id="section5">
      <div class="container mx-auto py-8">
        <h1 class="text-4xl font-bold text-center text-blue-600 mb-10">섹션 5 빈 화면</h1>
        <p class="text-center text-gray-600">이곳은 빈 화면입니다. 추후에 콘텐츠를 추가할 수 있습니다.</p>
      </div>
    </div>
  </div>

  <!-- JavaScript 라이브러리 -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/4.0.13/fullpage.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      initializeCalendar();
      setupFormHandler();
      initializeFullPage();
    });

    /**
     * fullPage.js 초기화 함수
     */
    function initializeFullPage() {
      new fullpage('#fullpage', {
        autoScrolling: false,
        fitToSection: true,
        navigation: true,
        anchors: ['section1', 'section2', 'section3', 'section4', 'section5'],
        navigationTooltips: ['첫 화면', '일정', '지원 자격', '합격 예측', '빈 화면'],
        showActiveTooltip: true,
        scrollingSpeed: 700,
        scrollBar: false,
      });
    }

    /**
     * FullCalendar 초기화 함수
     */
    function initializeCalendar() {
      const calendarEl = document.getElementById('calendar');
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'ko',
        events: '/calendar/events/',  // 이벤트 데이터 URL을 수정하세요
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth'
        },
        buttonText: {
          today: '오늘',
          month: '월',
          week: '주',
          day: '일'
        },
        eventClick: handleEventClick
      });
      calendar.render();
    }

    /**
     * 이벤트 클릭 시 모달 표시 핸들러
     * @param {Object} info - 이벤트 정보
     */
    function handleEventClick(info) {
      const { title, start, end, extendedProps } = info.event;
      const modalHtml = `
        <div class="modal-overlay">
          <div class="modal-content">
            <button class="close-modal" onclick="closeModal();">×</button>
            <h5 class="text-xl font-bold">${title}</h5>
            <div class="mt-4">
              <p><strong>시작일:</strong> ${formatDate(start)}</p>
              <p><strong>종료일:</strong> ${end ? formatDate(end) : 'N/A'}</p>
              <p><strong>추가 정보:</strong> ${extendedProps.content || '추가 정보 없음'}</p>
            </div>
            <div class="mt-4 text-right">
              <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded" onclick="closeModal();">닫기</button>
            </div>
          </div>
        </div>
      `;
      const modalContainer = document.createElement('div');
      modalContainer.id = 'eventModal';
      modalContainer.innerHTML = modalHtml;
      document.body.appendChild(modalContainer);
    }

    /**
     * 날짜 형식 변환 함수
     * @param {Date} date - 날짜 객체
     * @returns {string} - 포맷된 날짜 문자열
     */
    function formatDate(date) {
      return date.toLocaleDateString();
    }

    /**
     * 모달 닫기 함수
     */
    function closeModal() {
      const modal = document.getElementById('eventModal');
      if (modal) {
        modal.remove();
      }
    }

    /**
     * 폼 초기화 함수
     */
    function resetForm() {
      const form = document.getElementById('score-form');
      form.reset();
      document.getElementById('result').innerHTML = '';
    }

    /**
     * 점수 계산 폼 제출 핸들러 설정 함수
     */
    function setupFormHandler() {
      const form = document.getElementById('score-form');
      form.addEventListener('submit', handleFormSubmit);
    }

    /**
     * 점수 계산 폼 제출 핸들러
     * @param {Event} event - 제출 이벤트
     */
    function handleFormSubmit(event) {
      event.preventDefault();

      const formData = new FormData(event.target);
      const additionalScores = formData.getAll('additional_score[]').map(Number);
      const additionalScoreTotal = additionalScores.reduce((acc, score) => acc + score, 0);
      const licenseScore = Number(formData.get('license_score'));
      const attendanceScore = Number(formData.get('attendance_score'));
      const interviewScore = Number(formData.get('interview_score'));
      const totalScore = licenseScore + attendanceScore + interviewScore + additionalScoreTotal;

      const csrfToken = formData.get('csrfmiddlewaretoken');

      fetch('/calculate-score/', {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrfToken,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          license_score: licenseScore,
          attendance_score: attendanceScore,
          interview_score: interviewScore,
          additional_scores: additionalScores
        })
      })
      .then(response => response.json())
      .then(data => displayResult(data))
      .catch(error => console.error('Error:', error));
    }

    /**
     * 결과 표시 함수
     * @param {Object} data - 서버로부터 받은 데이터
     */
    function displayResult(data) {
      const resultContainer = document.getElementById('result');

      const totalScore = data.total_score || 0;
      const result = data.result || '결과 없음';
      const predictedCutoff = data.predicted_cutoff !== undefined ? data.predicted_cutoff.toFixed(2) : '예측 불가';
      const latestCutoff = data.latest_cutoff !== undefined ? data.latest_cutoff : '불명';

      if (resultContainer) {
        resultContainer.innerHTML = `
          <p><strong>총점:</strong> ${totalScore}점</p>
          <p><strong>결과:</strong> ${result}</p>
          <p><strong>예상 커트라인:</strong> ${predictedCutoff}점</p>
          <p><strong>가장 최근 커트라인:</strong> ${latestCutoff}점</p>
        `;
      } else {
        console.error("Result container not found.");
      }

      // 결과 표시 후 fullPage.js 재빌드
      fullpage_api.reBuild();
    }
  </script>
</body>
</html>
