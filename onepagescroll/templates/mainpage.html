<!DOCTYPE html>
<html lang="ko">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>참고해라 - 공군 지원 정보 서비스</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- fullPage.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/4.0.13/fullpage.min.css" />

  <style>
    /* 기본 스타일 */
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Nunito', sans-serif;
      height: 100%;
      width: 100%;
    }

    /* 섹션 스타일 */
    .section {
      height: 100vh;
      width: 100%;
      position: relative;
    }

    /* 섹션 1 배경 이미지 */
    #section1 {
      background-image: url('{% static "images/airforcebg.svg" %}');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* 섹션 2 배경 색상 */
    #section2 {
      background-color: #f8f9fa;
    }

    /* FullCalendar 스타일 */
    .fc-toolbar-title {
      font-size: 1.75rem;
      font-weight: 600;
      color: #2C3E50;
    }

    .fc-button {
      background-color: #6c757d !important;
      border: none !important;
      padding: 10px 20px !important;
      color: white !important;
      font-weight: 600 !important;
      border-radius: 5px !important;
    }

    .fc-button:hover {
      background-color: #5a6268 !important;
    }

    .fc-event {
      background-color: skyblue !important;
      border: none !important;
      color: white !important;
      font-weight: 600 !important;
      padding: 2px 5px !important;
      border-radius: 4px !important;
    }

    .fc-today {
      background-color: rgba(108, 117, 125, 0.2) !important;
    }

    #calendar {
      width: 90%;
      height: 700px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* 폼 스타일 */
    #score-form {
      max-width: 1200px;
      width: 90%;
      margin: 0 auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #score-form label {
      font-weight: 600;
      font-size: 1.1rem;
    }

    #score-form select,
    #score-form input[type="checkbox"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #ddd;
      font-size: 1.1rem;
    }

    #score-form button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      font-size: 1.2rem;
    }

    .additional-score-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
    }

    /* 반응형 디자인 */
    @media (max-width: 1400px) {
      #score-form {
        width: 95%;
      }
      .additional-score-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (max-width: 768px) {
      .additional-score-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .additional-score-grid {
        grid-template-columns: 1fr;
      }
    }

    /* 모달 스타일 */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    .modal-content button.close-modal {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #555;
    }
  </style>
</head>
<body>
  <div id="fullpage">
    <!-- 섹션 1 -->
    <div class="section" data-anchor="section1" id="section1">
      <!-- 콘텐츠 박스 -->
      <div class="content-wrapper text-center z-10 px-8 py-16 bg-white bg-opacity-80 shadow-xl rounded-lg">
        <h1 class="text-6xl font-extrabold text-blue-600 animate-fade-in">공군 지원 정보 서비스</h1>
        <h1 class="text-6xl font-extrabold text-blue-600 animate-fade-in">"참고해라"</h1>
        <p class="mt-6 text-xl text-gray-800">가기 싫은 군대, 공군이라도 가자..</p>
        <p class="mt-6 text-xl text-gray-800">아래로 스크롤해 지원 정보와 합격 가능성을 알아보자.</p>
        <div class="mt-8">
          <a href="#section2" class="inline-block px-6 py-3 text-white bg-blue-500 hover:bg-blue-600 rounded-lg shadow-lg transition duration-300 ease-in-out">
            일정 보러가기
          </a>
        </div>
      </div>
    </div>

    <!-- 섹션 2 -->
    <div class="section" data-anchor="section2" id="section2">
      <div class="container mx-auto py-8">
        <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">군대 지원 정보 캘린더</h1>
        <div id="calendar" class="bg-white p-4 rounded-lg shadow-lg"></div>
      </div>
    </div>

    <!-- 섹션 3 -->
    <div class="section" data-anchor="section3" id="section3">
      <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">공군 일반 기술병 점수 계산기</h1>
      <p class="text-center text-gray-600 mb-10">아래에서 골라 합격을 예측해보세요!</p>

      <form method="POST" class="space-y-4" id="score-form">
        {% csrf_token %}

        <!-- 자격/면허 점수 -->
        <div>
          <label for="license_score" class="block text-lg font-semibold text-gray-700 mb-2">자격/면허 점수</label>
          <select name="license_score" id="license_score" required>
            <option value="0">자격증 없음 (0점)</option>
            <option value="60">일반자격증 - L2 (60점)</option>
            <option value="62">일반자격증 - L4, L3 (62점)</option>
            <option value="64">일반자격증 - L6, L5 (64점)</option>
            <option value="66">국가기술자격증 - 기능사 (66점)</option>
            <option value="68">국가기술자격증 - 산업기사 (68점)</option>
            <option value="70">국가기술자격증 - 기사 이상 (70점)</option>
          </select>
        </div>

        <!-- 출결 점수 -->
        <div>
          <label for="attendance_score" class="block text-lg font-semibold text-gray-700 mb-2">출결 점수</label>
          <select name="attendance_score" id="attendance_score" required>
            <option value="16">결석 7일 이상 (16점)</option>
            <option value="17">결석 5~6일 (17점)</option>
            <option value="18">결석 3~4일 (18점)</option>
            <option value="19">결석 1~2일 (19점)</option>
            <option value="20">결석 0일 (20점)</option>
          </select>
        </div>

        <!-- 면접 점수 -->
        <div>
          <label for="interview_score" class="block text-lg font-semibold text-gray-700 mb-2">면접 점수</label>
          <select name="interview_score" id="interview_score" required>
            <option value="25">면접 평가 부족 (25점)</option>
            <option value="30">면접 평가 보통 (30점)</option>
            <option value="35">면접 평가 우수 (35점)</option>
          </select>
        </div>

        <!-- 가산점 -->
        <div>
          <label class="block text-lg font-semibold text-gray-700 mb-2">가산점</label>
          <div class="additional-score-grid">
            <div class="flex items-center">
              <input type="checkbox" name="additional_score[]" value="1" id="option9">
              <label for="option9" class="ml-2">병역진로설계 군 추천특기 (1점)</label>
            </div>
            <div class="flex items-center">
              <input type="checkbox" name="additional_score[]" value="2" id="option6">
              <label for="option6" class="ml-2">다자녀(2인) 가정자녀 (2점)</label>
            </div>
            <div class="flex items-center">
              <input type="checkbox" name="additional_score[]" value="2" id="option10">
              <label for="option10" class="ml-2">한국사능력검정 1, 2급 (2점)</label>
            </div>
            <div class="flex items-center">
              <input type="checkbox" name="additional_score[]" value="4" id="option1">
              <label for="option1" class="ml-2">국가 유공자 자녀/손자녀 (4점)</label>
            </div>
            <div class="flex items-center">
              <input type="checkbox" name="additional_score[]" value="4" id="option2">
              <label for="option2" class="ml-2">질병치유 자진입대 (4점)</label>
            </div>
            <div class="flex items-center">
              <input type="checkbox" name="additional_score[]" value="4" id="option3">
              <label for="option3" class="ml-2">현역병 입영대상으로 역종 변경 (4점)</label>
            </div>
          </div>
        </div>

        <!-- 제출 및 초기화 버튼 -->
        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white rounded-lg">점수 계산하기</button>
        <button type="button" class="bg-gray-500 hover:bg-gray-600 text-white rounded-lg mt-4" onclick="resetForm();">초기화</button>

        <!-- 결과 표시 -->
        <div id="result" class="mt-8 bg-green-100 p-4 rounded-lg text-center text-lg"></div>
      </form>
    </div>
  </div>

  <!-- JavaScript 라이브러리 -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullPage.js/4.0.13/fullpage.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      initializeFullPage();
      initializeCalendar();
      setupFormHandler();
    });

    /**
     * fullPage.js 초기화 함수
     */
    function initializeFullPage() {
      new fullpage('#fullpage', {
        autoScrolling: false,
        fitToSection: true,
        navigation: true,
        anchors: ['section1', 'section2', 'section3'],
        navigationTooltips: ['첫 화면', '일정', '합격 예측'],
        showActiveTooltip: true,
        scrollingSpeed: 700,
        scrollBar: false,
      });

      // 캘린더 렌더링 후 fullPage.js 재빌드
      setTimeout(() => {
        fullpage_api.reBuild();
      }, 500);
    }

    /**
     * FullCalendar 초기화 함수
     */
    function initializeCalendar() {
      const calendarEl = document.getElementById('calendar');
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'ko',
        events: '/calendar/events/',  // 이벤트 데이터 URL을 수정하세요
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth'
        },
        buttonText: {
          today: '오늘',
          month: '월',
          week: '주',
          day: '일'
        },
        eventClick: handleEventClick
      });
      calendar.render();
    }

    /**
     * 이벤트 클릭 시 모달 표시 핸들러
     * @param {Object} info - 이벤트 정보
     */
    function handleEventClick(info) {
      const { title, start, end, extendedProps } = info.event;
      const modalHtml = `
        <div class="modal-overlay">
          <div class="modal-content">
            <button class="close-modal" onclick="closeModal();">×</button>
            <h5 class="text-xl font-bold">${title}</h5>
            <div class="mt-4">
              <p><strong>시작일:</strong> ${formatDate(start)}</p>
              <p><strong>종료일:</strong> ${end ? formatDate(end) : 'N/A'}</p>
              <p><strong>추가 정보:</strong> ${extendedProps.content || '추가 정보 없음'}</p>
            </div>
            <div class="mt-4 text-right">
              <button class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded" onclick="closeModal();">닫기</button>
            </div>
          </div>
        </div>
      `;
      const modalContainer = document.createElement('div');
      modalContainer.id = 'eventModal';
      modalContainer.innerHTML = modalHtml;
      document.body.appendChild(modalContainer);
    }

    /**
     * 날짜 형식 변환 함수
     * @param {Date} date - 날짜 객체
     * @returns {string} - 포맷된 날짜 문자열
     */
    function formatDate(date) {
      return date.toLocaleDateString();
    }

    /**
     * 모달 닫기 함수
     */
    function closeModal() {
      const modal = document.getElementById('eventModal');
      if (modal) {
        modal.remove();
      }
    }

    /**
     * 폼 초기화 함수
     */
    function resetForm() {
      const form = document.getElementById('score-form');
      form.reset();
      document.getElementById('result').innerHTML = '';
    }

    /**
     * 점수 계산 폼 제출 핸들러 설정 함수
     */
    function setupFormHandler() {
      const form = document.getElementById('score-form');
      form.addEventListener('submit', handleFormSubmit);
    }

    /**
     * 점수 계산 폼 제출 핸들러
     * @param {Event} event - 제출 이벤트
     */
    function handleFormSubmit(event) {
      event.preventDefault();

      const formData = new FormData(event.target);
      const additionalScores = formData.getAll('additional_score[]').map(Number);
      const additionalScoreTotal = additionalScores.reduce((acc, score) => acc + score, 0);
      const licenseScore = Number(formData.get('license_score'));
      const attendanceScore = Number(formData.get('attendance_score'));
      const interviewScore = Number(formData.get('interview_score'));
      const totalScore = licenseScore + attendanceScore + interviewScore + additionalScoreTotal;

      const csrfToken = formData.get('csrfmiddlewaretoken');

      fetch('/calculate-score/', {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrfToken,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          license_score: licenseScore,
          attendance_score: attendanceScore,
          interview_score: interviewScore,
          additional_scores: additionalScores
        })
      })
      .then(response => response.json())
      .then(data => displayResult(data))
      .catch(error => console.error('Error:', error));
    }

    /**
   /**
 * 결과 표시 함수
 * @param {Object} data - 서버로부터 받은 데이터
 */
/**
 * 결과 표시 함수
 * @param {Object} data - 서버로부터 받은 데이터
 */
 function displayResult(data) {
  const resultContainer = document.getElementById('result');

  // 데이터가 제대로 들어왔는지 확인하고, 없는 경우 기본값 설정
  const totalScore = data.total_score || 0;
  const result = data.result || '결과 없음';
  const predictedCutoff = data.predicted_cutoff !== undefined ? data.predicted_cutoff.toFixed(2) : '예측 불가';
  const latestCutoff = data.latest_cutoff !== undefined ? data.latest_cutoff : '불명';

  // 서버로부터 받은 데이터를 기반으로 결과 표시
  if (resultContainer) {
    resultContainer.innerHTML = `
      <p><strong>총점:</strong> ${totalScore}점</p>
      <p><strong>결과:</strong> ${result}</p>
      <p><strong>예상 커트라인:</strong> ${predictedCutoff}점</p>
      <p><strong>가장 최근 커트라인:</strong> ${latestCutoff}점</p>
    `;
  } else {
    console.error("Result container not found.");
  }
}

      // 결과 렌더 후 fullPage.js 재빌드
      setTimeout(() => {
        fullpage_api.reBuild();
      }, 500);
    
  </script>
</body>
</html>
